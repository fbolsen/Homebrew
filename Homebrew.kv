#:kivy 1.0.9

<TimeWidget>:
    orientation: 'vertical'
    ToggleButton:
        group: 'mygroup'
        text: 'time'
        state: 'down'
        id: tgl_time
        on_press: root.set_mode(self.text)
    ToggleButton:
        group: 'mygroup'
        text: 'elapsed'
        on_press: root.set_mode(self.text)
    ToggleButton:
        group: 'mygroup'
        text: 'remaining'
        on_press: root.set_mode(self.text)
    Label:
        id: lbl_time
        text: '12:00'

<TempWidget>:
    orientation: 'horizontal'
    #size_hint: (1.0, 0.2)
    BoxLayout:
        orientation: 'vertical'
        size_hint: (None, 1.0)
        width: 100
        Button:
            text: 'Up:'
            on_press: root.up()
        Button:
            text: 'Down'
            on_press: root.down()
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Target:'
        Label:
            id: lbl_setpoint
            text: str(root.setpoint)
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Temp:'
        Label:
            id: lbl_temp
            text: "{0:.2f}".format(root.temp)

<PIDWidget>:
    #orientation: 'horizontal'
    #size_hint: (None, 1.0)
    #BoxLayout:
    orientation: 'vertical'
    size_hint: (None, 1.0)
    width: 800
    BoxLayout:
        Label:
            text: 'Kp:'
        Label:
            id: lbl_Kp
            text: "{0:.6g}".format(root.Kp)
        Slider:
            id: sl_Kp
            min: 0.0
            max: 100.0
            value: 5.0
            on_value: root.update_Kp()
    BoxLayout:
        Label:
            text: 'Ki:'
        Label:
            id: lbl_Ki
            text: "{0:.6g}".format(root.Ki)
        Slider:
            id: sl_Ki
            min: 0.0
            max: 100.0
            value: 25.0
            on_value: root.update_Ki()
    BoxLayout:
        Label:
            text: 'Kd:'
        Label:
            id: lbl_Kd
            text: "{0:.6g}".format(root.Kd)
        Slider:
            id: sl_Kd
            min: 0.0
            max: 100.0
            value: 25.0
            on_value: root.update_Kd()
    Button:
        id: pid_reset
        text: 'Reset'
        on_press: root.pid_reset()


<PWMWidget>:
    orientation: 'vertical'
    BoxLayout:
        orientation: 'horizontal'
        CheckBox:
            id: chk_override
            text: 'Override PID'
            on_press: root.toggle()
            canvas.before:
                #Color:
                #    rgba: 1, .5, 0, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

    Label:
        text: 'Power'
        canvas.before:
            #Color:
            #    rgba: 1, .5, 0, 1
            Rectangle:
                pos: self.pos
                size: self.size
    Label:
        id: lbl_power
        text: "{0:.2f}".format(root.power)
        #background_normal: ''
        #background_color: 1,1,0,1
        #color: 0,1,0,1 #text color
    BoxLayout:
        orientation: 'horizontal'
        Slider:
            id: sl_power
            min: 0.0
            max: 100.0
            value: root.power
            on_value: root.update_power()



<Homebrew>:
    id: bl
    orientation: 'vertical'
    temp_widget: temp_w
    pid_widget: pid_w
    pwm_widget: pwm_w
    time_widget: time_w
    BoxLayout:
        id: bl_top
        orientation: 'horizontal'
        size_hint: (1.0, 0.1)
        Button:
            id: btn_connect
            text: 'Connect'
            on_press: root.connect()
            #background_normal: ''
            #color: 1, .3, .4, .85
        Button:
            id: btn_start
            #color: 0,1,0,1 #text color
            #background_normal: ''
            #background_color: 1,1,0,1
            text: 'Start mash'
            on_press: root.start_mash()
        Button:
            id: btn_stop
            text: 'Stop mash'
            on_press: root.stop_mash()
    BoxLayout:
        size_hint: (1.0, 0.1)
        #Label:
        #    text: 'Temps'
        TempWidget:
            id: temp_w
        TimeWidget:
            id: time_w
    BoxLayout:
        id: bl_plot
        size_hint: (1.0, 0.5)
    BoxLayout:
        orientation: 'horizontal'
        id: bl_bottom
        size_hint: (1.0, 0.1)
        PIDWidget:
            id: pid_w
        PWMWidget:
            id: pwm_w